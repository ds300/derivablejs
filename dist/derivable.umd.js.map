{"version":3,"sources":["../src/util.js","../src/types.js","../src/states.js","../src/parents.js","../src/transactions.js","../src/derivation.js","../src/reactors.js","../src/atom.js","../src/lens.js","../src/module.js","../src/derivable.js","../src/mutable.js","../src/index.js"],"names":["setDebugMode","isDerivable","isAtom","isDerivation","isLensed","util.addToArray","transact","atomically","transaction","util.slice","atomic","ticker","types.DERIVATION","util.unique","util.DEBUG_MODE","util.assign","util.setEquals","derivation","parents.startCapturingParents","parents.retrieveParentsFrame","parents.stopCapturingParents","parents.maybeCaptureParent","util.removeFromArray","types.REACTOR","types.isDerivable","util.nextId","atom","transactions.maybeTrack","transactions.inTransaction","transactions.mark","transactions.processReactors","types.LENS","lens","__Reactor","reactors.Reactor","transactions.transact","util.setDebugMode","transactions.transaction","transactions.ticker","types.isAtom","types.isLensed","types.isDerivation","_atom","transactions.atomic","transactions.atomically","_lens","derive","unpack","lift","keys","util.keys","struct","wrapPreviousState","captureDereferences","or","mOr","util.some","and","mAnd","util.equals","derivable.transaction","derivable.ticker","derivable.isDerivable","derivable.isAtom","derivable.isLensed","derivable.derivation","derivable.atom","derivable.atomic","derivable.atomically","derivable.lens","derivable.unpack","derivable.lift","derivable.and","derivable.mAnd"],"mappings":";;;;;;;;;;;;;;;AAAO,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;;AAEvB,SAAS,MAAM,EAAE,GAAG,EAAE;EAC3B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;IACzC,IAAI,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;IACzB,IAAI,EAAE,GAAG,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;IAC3B,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG;MAC5B,IAAI,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;MACjB,GAAG,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;KACzB;GACF;EACD,OAAO,GAAG,CAAC;CACZ;;AAED,SAAS,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE;;EAEjB,IAAI,CAAC,KAAK,CAAC,EAAE;;IAEX,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;GACnC,MAAM;;IAEL,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GAC3B;CACF;;AAEM,SAAS,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE;EAC5B,OAAO,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,MAAM,KAAK,UAAU,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;CAC1E,CAAC;;AAEK,SAAS,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE;EAChC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;EACrB,IAAI,CAAC,GAAG,CAAC,EAAE;IACT,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;GACX;CACF,CAAC;;AAEK,SAAS,eAAe,EAAE,CAAC,EAAE,CAAC,EAAE;EACrC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;EACrB,IAAI,CAAC,IAAI,CAAC,EAAE;IACV,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;GAChB;CACF,CAAC;;AAEF,IAAI,OAAO,GAAG,CAAC,CAAC;AACT,SAAS,MAAM,IAAI;EACxB,OAAO,OAAO,EAAE,CAAC;CAClB,CAAC;;AAEK,SAAS,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE;EAC3B,OAAO,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;CACzC,CAAC;;AAEK,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,YAAY,EAAE,OAAO,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC;;AAEpE,SAAS,IAAI,EAAE,CAAC,EAAE;EACvB,OAAO,CAAC,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC;CACvC,CAAC;;AAEK,IAAI,UAAU,GAAG,KAAK,CAAC;AACvB,SAASA,cAAY,EAAE,GAAG,EAAE;EACjC,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC;CACpB,CAAC;;AAEK,SAAS,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE;EAC5C,SAAS,CAAC,OAAO,GAAG,MAAM,CAAC;EAC3B,OAAO,SAAS,CAAC;CAClB,CAAC;;AClEK,IAAI,IAAI,GAAG,MAAM,CAAC;AAClB,IAAI,UAAU,GAAG,YAAY,CAAC;AAC9B,IAAI,IAAI,GAAG,MAAM,CAAC;AAClB,IAAI,OAAO,GAAG,SAAS,CAAC;;AAExB,SAASC,aAAW,CAAC,CAAC,EAAE;EAC7B,OAAO,CAAC;SACD,CAAC,CAAC,CAAC,KAAK,KAAK,UAAU;UACtB,CAAC,CAAC,KAAK,KAAK,IAAI;UAChB,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC;CAC3B;;AAEM,SAASC,QAAM,EAAE,CAAC,EAAE;EACzB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,KAAK,IAAI,IAAI,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC;CACpD;;AAEM,SAASC,cAAY,EAAE,CAAC,EAAE;EAC/B,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,KAAK,UAAU,IAAI,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC;CAC1D;;AAEM,SAASC,UAAQ,EAAE,CAAC,EAAE;EAC3B,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC;CAC9B;;ACtBM,IAAI,OAAO,GAAG,CAAC,CAAC;AAChB,IAAI,OAAO,GAAG,CAAC,CAAC;AAChB,IAAI,SAAS,GAAG,CAAC,CAAC;AAClB,IAAI,YAAY,GAAG,CAAC,CAAC;;ACD5B,IAAI,YAAY,GAAG,EAAE,CAAC;AACtB,IAAI,KAAK,GAAG,IAAI,CAAC;;AAEV,SAAS,qBAAqB,EAAE,MAAM,EAAE,OAAO,EAAE;EACtD,YAAY,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;EAChE,KAAK,GAAG,MAAM,CAAC;CAChB;AACM,SAAS,oBAAoB,IAAI;EACtC,OAAO,YAAY,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;CAC9C;AACM,SAAS,oBAAoB,IAAI;EACtC,YAAY,CAAC,GAAG,EAAE,CAAC;EACnB,KAAK,GAAG,YAAY,CAAC,MAAM,KAAK,CAAC;YACvB,IAAI;YACJ,YAAY,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC;CACvD;;AAEM,SAAS,kBAAkB,EAAE,CAAC,EAAE;EACrC,IAAI,KAAK,KAAK,IAAI,EAAE;IAClB,IAAI,KAAK,GAAG,YAAY,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IAClD,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;;MAErC,KAAK,CAAC,MAAM,EAAE,CAAC;KAChB,MAAM;;MAEL,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;MACnC,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE;;;;;QAKd,IAAI,KAAK,KAAK,KAAK,CAAC,EAAE;UACpBC,UAAe,CAAC,CAAC,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;SAC3C;QACD,IAAI,KAAK,CAAC,MAAM,KAAK,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE;UACzC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SACvB,MAAM;UACL,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;UAChD,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACjC;QACD,KAAK,CAAC,MAAM,EAAE,CAAC;OAChB,MAAM;QACL,IAAI,GAAG,GAAG,KAAK,CAAC,MAAM,EAAE;;;UAGtB,IAAI,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;UAC7B,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;UACjD,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;UAClC,KAAK,CAAC,MAAM,EAAE,CAAC;SAChB;;OAEF;KACF;GACF;CACF,CAAC;;ACpDK,SAAS,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE;EACpC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;IAC/D,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;IACpC,QAAQ,KAAK,CAAC,KAAK;MACjB,KAAK,UAAU,CAAC;MAChB,KAAK,IAAI;QACP,IAAI,KAAK,CAAC,MAAM,KAAK,OAAO,EAAE;UAC5B,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;UACvB,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;SACvB;QACD,MAAM;MACR,KAAK,OAAO;QACV,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACrB,MAAM;KACT;GACF;CACF;;AAEM,SAAS,eAAe,EAAE,QAAQ,EAAE;EACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;IACnD,IAAI,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IACpB,IAAI,CAAC,CAAC,SAAS,EAAE;MACf,MAAM,IAAI,KAAK,CAAC,6CAA6C;sBAC7C,mBAAmB,CAAC,CAAC;KACtC;IACD,CAAC,CAAC,WAAW,EAAE,CAAC;GACjB;CACF;;AAED,IAAI,mBAAmB,GAAG,EAAE,CAAC;;AAE7B,SAAS,gBAAgB,GAAG;EAC1B,MAAM,mBAAmB,CAAC;CAC3B;;AAED,SAAS,kBAAkB,CAAC,MAAM,EAAE;EAClC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;EACrB,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;EAC3B,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;CACzB;;AAEM,SAAS,UAAU,EAAE,IAAI,EAAE;EAChC,IAAI,UAAU,KAAK,IAAI,EAAE;IACvB,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI,UAAU,CAAC,gBAAgB,CAAC,EAAE;MAC9C,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;MACpC,UAAU,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;KACrD;GACF;CACF;;AAEM,IAAI,UAAU,GAAG,IAAI,CAAC;;AAEtB,SAAS,aAAa,IAAI;EAC/B,OAAO,UAAU,KAAK,IAAI,CAAC;CAC5B,CAAC;;AAEK,SAASC,UAAQ,EAAE,CAAC,EAAE;EAC3B,gBAAgB,EAAE,CAAC;EACnB,IAAI;IACF,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;GAChC;EACD,OAAO,CAAC,EAAE;IACR,gBAAgB,EAAE,CAAC;IACnB,IAAI,CAAC,KAAK,mBAAmB,EAAE;MAC7B,MAAM,CAAC,CAAC;KACT;IACD,OAAO;GACR;EACD,iBAAiB,EAAE,CAAC;CACrB,CAAC;;AAEK,SAASC,YAAU,EAAE,CAAC,EAAE;EAC7B,IAAI,CAAC,aAAa,EAAE,EAAE;IACpBD,UAAQ,CAAC,CAAC,CAAC,CAAC;GACb,MAAM;IACL,CAAC,EAAE,CAAC;GACL;CACF;;AAEM,SAASE,aAAW,EAAE,CAAC,EAAE;EAC9B,OAAO,YAAY;IACjB,IAAI,IAAI,GAAGC,KAAU,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;IACpC,IAAI,IAAI,GAAG,IAAI,CAAC;IAChB,IAAI,MAAM,CAAC;IACXH,UAAQ,CAAC,YAAY;MACnB,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;KAC9B,CAAC,CAAC;IACH,OAAO,MAAM,CAAC;GACf,CAAC;CACH,CAAC;;AAEK,SAASI,QAAM,EAAE,CAAC,EAAE;EACzB,OAAO,YAAY;IACjB,IAAI,IAAI,GAAGD,KAAU,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;IACpC,IAAI,IAAI,GAAG,IAAI,CAAC;IAChB,IAAI,MAAM,CAAC;IACXF,YAAU,CAAC,YAAY;MACrB,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;KAC9B,CAAC,CAAC;IACH,OAAO,MAAM,CAAC;GACf,CAAC;CACH;;AAED,SAAS,gBAAgB,GAAG;EAC1B,UAAU,GAAG,IAAI,kBAAkB,CAAC,UAAU,CAAC,CAAC;CACjD;;AAED,SAAS,iBAAiB,GAAG;EAC3B,IAAI,GAAG,GAAG,UAAU,CAAC;EACrB,UAAU,GAAG,GAAG,CAAC,MAAM,CAAC;;EAExB,IAAI,UAAU,KAAK,IAAI,EAAE;IACvB,IAAI,QAAQ,GAAG,EAAE,CAAC;IAClB,GAAG,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;MACrC,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,EAAE,GAAG,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE;QACrD,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC;OACtB,MAAM;QACL,CAAC,CAAC,MAAM,GAAG,OAAO,CAAC;QACnB,IAAI,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;OACnB;KACF,CAAC,CAAC;IACH,eAAe,CAAC,QAAQ,CAAC,CAAC;IAC1B,GAAG,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;MACrC,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC;KACtB,CAAC,CAAC;GACJ;CACF;;AAED,SAAS,gBAAgB,GAAG;EAC1B,IAAI,GAAG,GAAG,UAAU,CAAC;EACrB,UAAU,GAAG,GAAG,CAAC,MAAM,CAAC;EACxB,GAAG,CAAC,aAAa,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;IACxC,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC7C,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;IACxB,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;GAChB,CAAC,CAAC;CACJ;;AAED,IAAI,eAAe,GAAG,CAAC,CAAC;;AAEjB,SAASI,QAAM,IAAI;EACxB,IAAI,eAAe,KAAK,CAAC,EAAE;IACzB,gBAAgB,EAAE,CAAC;GACpB;EACD,eAAe,EAAE,CAAC;EAClB,IAAI,IAAI,GAAG,KAAK,CAAC;EACjB,OAAO;IACL,IAAI,EAAE,YAAY;MAChB,IAAI,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;MAChE,iBAAiB,EAAE,CAAC;MACpB,gBAAgB,EAAE,CAAC;KACpB;IACD,KAAK,EAAE,YAAY;MACjB,IAAI,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;MAChE,gBAAgB,EAAE,CAAC;MACnB,gBAAgB,EAAE,CAAC;KACpB;IACD,OAAO,EAAE,YAAY;MACnB,IAAI,IAAI,EAAE,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;MACrD,eAAe,EAAE,CAAC;MAClB,IAAI,GAAG,IAAI,CAAC;MACZ,IAAI,eAAe,KAAK,CAAC,EAAE;QACzB,iBAAiB,EAAE,CAAC;OACrB;KACF;GACF,CAAC;CACH,CAAC;;ACpKK,SAAS,UAAU,EAAE,OAAO,EAAE;EACnC,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;EACxB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;EACrB,IAAI,CAAC,KAAK,GAAGC,UAAgB,CAAC;EAC9B,IAAI,CAAC,MAAM,GAAGC,MAAW,CAAC;EAC1B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;EACpB,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;EAC1B,IAAI,CAAC,MAAM,GAAG,YAAY,CAAC;;EAE3B,IAAIC,UAAe,EAAE;IACnB,IAAI,CAAC,KAAK,GAAG,KAAK,EAAE,CAAC,KAAK,CAAC;GAC5B;CACF,CAAC;;AAEFC,MAAW,CAAC,UAAU,CAAC,SAAS,EAAE;EAChC,MAAM,EAAE,YAAY;IAClB,OAAOC,SAAc,CAACC,WAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;GAChE;;EAED,UAAU,EAAE,YAAY;IACtB,IAAI,IAAI,GAAG,IAAI,CAAC;IAChB,IAAI,MAAM,GAAG,IAAI,CAAC;IAClB,IAAI,aAAa,CAAC;;IAElB,IAAI;MACF,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,EAAE;QAC1B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;OACpB;MACDC,qBAA6B,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;MACnD,IAAI,CAACJ,UAAe,EAAE;QACpB,MAAM,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;OAC1B,MAAM;QACL,IAAI;UACF,MAAM,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;SAC1B,CAAC,OAAO,CAAC,EAAE;UACV,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;UAC1B,MAAM,CAAC,CAAC;SACT;OACF;MACD,aAAa,GAAGK,oBAA4B,EAAE,CAAC,MAAM,CAAC;KACvD,SAAS;MACRC,oBAA4B,EAAE,CAAC;KAChC;;IAED,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE;MACvC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;KACvB,MAAM;MACL,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;KACzB;;IAED,KAAK,IAAI,CAAC,GAAG,aAAa,EAAE,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;MACpE,IAAI,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;MACjC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;MACxB,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;KACzB;;IAED,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,aAAa,CAAC;;IAErC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;GACtB;;EAED,OAAO,EAAE,YAAY;IACnB,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,EAAE;;MAE1B,IAAI,CAAC,UAAU,EAAE,CAAC;;KAEnB,MAAM,IAAI,IAAI,CAAC,MAAM,KAAK,OAAO,EAAE;MAClC,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;MAC/B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;QAC5B,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;;QAE9B,IAAI,MAAM,CAAC,MAAM,KAAK,OAAO,EAAE;UAC7B,MAAM,CAAC,OAAO,EAAE,CAAC;SAClB;;QAED,IAAI,MAAM,CAAC,MAAM,KAAK,OAAO,EAAE;UAC7B,IAAI,CAAC,UAAU,EAAE,CAAC;UAClB,MAAM;SACP;OACF;MACD,IAAI,IAAI,CAAC,MAAM,KAAK,OAAO,EAAE;QAC3B,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;OACzB;KACF;GACF;;EAED,GAAG,EAAE,YAAY;IACfC,kBAA0B,CAAC,IAAI,CAAC,CAAC;IACjC,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE;MACnC,IAAI,CAAC,OAAO,EAAE,CAAC;KAChB,MAAM;MACLH,qBAA6B,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC;MAC1C,IAAI;QACF,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;OAC/B,SAAS;QACRE,oBAA4B,EAAE,CAAC;OAChC;KACF;IACD,OAAO,IAAI,CAAC,MAAM,CAAC;GACpB;CACF,CAAC,CAAC;;AAEI,SAAS,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE;EACrCE,eAAoB,CAAC,MAAM,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;EACpD,IAAI,MAAM,CAAC,eAAe,CAAC,MAAM,KAAK,CAAC,IAAI,MAAM,CAAC,QAAQ,IAAI,IAAI,EAAE;IAClE,IAAI,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;IACjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;MAC5B,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;KACpC;IACD,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,MAAM,CAAC,MAAM,GAAG,YAAY,CAAC;GAC9B;CACF;;AAEM,SAASL,WAAU,EAAE,OAAO,EAAE;EACnC,OAAO,IAAI,UAAU,CAAC,OAAO,CAAC,CAAC;CAChC;;ACrHM,SAAS,OAAO,CAAC,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE;EAC/C,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;EACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;EACnB,IAAI,CAAC,SAAS,GAAG,QAAQ,IAAI,IAAI,CAAC;EAClC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;EACrB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;EACvB,IAAI,CAAC,KAAK,GAAGM,OAAa,CAAC;;EAE3B,IAAIT,UAAe,EAAE;IACnB,IAAI,CAAC,KAAK,GAAG,KAAK,EAAE,CAAC,KAAK,CAAC;GAC5B;CACF;;AAEDC,MAAW,CAAC,OAAO,CAAC,SAAS,EAAE;EAC7B,KAAK,EAAE,YAAY;IACjB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;;IAEpBV,UAAe,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;;IAEpD,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;IACnB,OAAO,IAAI,CAAC;GACb;;EAED,MAAM,EAAE,UAAU,SAAS,EAAE;IAC3B,IAAI;MACF,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;MACtB,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;KACvB,CAAC,OAAO,CAAC,EAAE;MACV,IAAIS,UAAe,EAAE;QACnB,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;OAC3B;MACD,MAAM,CAAC,CAAC;KACT,SAAS;MACR,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;KACxB;GACF;;EAED,KAAK,EAAE,YAAY;IACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;;IAEhC,OAAO,IAAI,CAAC;GACb;;EAED,WAAW,EAAE,YAAY;IACvB,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO,EAAE;MACnC,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI,EAAE;QAC3B,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;OAC9B;;MAED,IAAI,IAAI,CAAC,OAAO,EAAE;QAChB,IAAI,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;QACnC,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,KAAK,OAAO,EAAE;UACnC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;SACxB;OACF;KACF;GACF;EACD,IAAI,EAAE,YAAY;IAChB,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IAC3B,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;IACrB,OAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEI,SAAS,WAAW,EAAE,SAAS,EAAE,CAAC,EAAE,IAAI,EAAE;EAC/C,IAAI,OAAO,CAAC,KAAK,UAAU,EAAE;IAC3B,MAAM,KAAK,CAAC,iDAAiD,CAAC,CAAC;GAChE;;EAED,IAAI,GAAGC,MAAW,CAAC;IACjB,IAAI,EAAE,KAAK;IACX,IAAI,EAAE,IAAI;IACV,KAAK,EAAE,KAAK;IACZ,IAAI,EAAE,IAAI;IACV,SAAS,EAAE,KAAK;GACjB,EAAE,IAAI,CAAC,CAAC;;EAET,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;;;EAG/B,SAAS,aAAa,CAAC,IAAI,EAAE,IAAI,EAAE;IACjC,IAAI,CAACS,aAAiB,CAAC,IAAI,CAAC,EAAE;MAC5B,IAAI,OAAO,IAAI,KAAK,UAAU,EAAE;QAC9B,OAAOP,WAAU,CAAC,IAAI,CAAC,CAAC;OACzB,MAAM,IAAI,OAAO,IAAI,KAAK,SAAS,EAAE;QACpC,OAAOA,WAAU,CAAC,YAAY,EAAE,OAAO,IAAI,CAAC,EAAE,CAAC,CAAC;OACjD,MAAM;QACL,MAAM,KAAK,CAAC,QAAQ,GAAG,IAAI,GAAG,qCAAqC,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;OAC7F;KACF;IACD,OAAO,IAAI,CAAC;GACb;;;;EAID,IAAI,OAAO,GAAG,IAAI,OAAO,CAAC,SAAS,EAAE,UAAU,GAAG,EAAE;IAClD,IAAI,SAAS,EAAE;MACb,SAAS,GAAG,KAAK,CAAC;KACnB,MAAM;MACL,CAAC,CAAC,GAAG,CAAC,CAAC;MACP,IAAI,IAAI,CAAC,IAAI,EAAE;QACb,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,UAAU,CAAC,IAAI,EAAE,CAAC;OACnB;KACF;GACF,CAAC,CAAC;;;;;EAKH,IAAI,MAAM,GAAG,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;EAChD,IAAI,KAAK,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;;EAE7C,IAAI,UAAU,GAAGA,WAAU,CAAC,YAAY;IACtC,OAAO;MACL,KAAK,EAAE,MAAM,CAAC,GAAG,EAAE;MACnB,IAAI,EAAE,KAAK,CAAC,GAAG,EAAE;KAClB,CAAC;GACH,CAAC,CAAC;;EAEH,IAAI,UAAU,GAAG,IAAI,OAAO,CAAC,UAAU,EAAE,UAAU,KAAK,EAAE;IACxD,IAAI,KAAK,CAAC,KAAK,EAAE;MACf,OAAO,CAAC,IAAI,EAAE,CAAC;MACf,IAAI,CAAC,IAAI,EAAE,CAAC;KACb,MAAM,IAAI,KAAK,CAAC,IAAI,EAAE;MACrB,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;QACpB,OAAO,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;OACzB;KACF,MAAM,IAAI,OAAO,CAAC,OAAO,EAAE;MAC1B,OAAO,CAAC,IAAI,EAAE,CAAC;KAChB;GACF,CAAC,CAAC;;EAEH,OAAO,CAAC,SAAS,GAAG,UAAU,CAAC;;;;EAI/B,IAAI,KAAK,GAAG,aAAa,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;EAC7C,IAAI,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,EAAE,UAAU,IAAI,EAAE;IACjD,IAAI,IAAI,EAAE;MACR,UAAU,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;MAC3B,IAAI,CAAC,IAAI,EAAE,CAAC;KACb;GACF,CAAC,CAAC;;EAEH,SAAS,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;CAC3B;;ACjJM,SAAS,IAAI,EAAE,KAAK,EAAE;EAC3B,IAAI,CAAC,GAAG,GAAGQ,MAAW,EAAE,CAAC;EACzB,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;EAC1B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;EACpB,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;EACxB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;EAClB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;EACpB,OAAO,IAAI,CAAC;CACb,CAAC;;AAEFV,MAAW,CAAC,IAAI,CAAC,SAAS,EAAE;EAC1B,MAAM,EAAE,YAAY;IAClB,OAAOC,SAAc,CAACU,MAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;GACxD;;EAED,GAAG,EAAE,UAAU,KAAK,EAAE;IACpBC,UAAuB,CAAC,IAAI,CAAC,CAAC;;IAE9B,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC;IAC3B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;;IAEpB,IAAI,CAACC,aAA0B,EAAE,EAAE;MACjC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;QACnC,IAAI;UACF,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;UACtB,IAAI,QAAQ,GAAG,EAAE,CAAC;UAClBC,IAAiB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;UAClCC,eAA4B,CAAC,QAAQ,CAAC,CAAC;SACxC,SAAS;UACR,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;SACzB;OACF;KACF;GACF;;EAED,GAAG,EAAE,YAAY;IACfT,kBAA0B,CAAC,IAAI,CAAC,CAAC;IACjC,OAAO,IAAI,CAAC,MAAM,CAAC;GACpB;CACF,CAAC,CAAC;;AAEI,SAASK,MAAI,EAAE,KAAK,EAAE;EAC3B,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC;CACxB;;AC5CM,SAAS,IAAI,EAAE,UAAU,EAAE;EAChC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC;EACtC,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;EAClC,IAAI,CAAC,KAAK,GAAGK,IAAU,CAAC;CACzB;;AAEDhB,MAAW,CAAC,IAAI,CAAC,SAAS,EAAE,UAAU,CAAC,SAAS,EAAE;EAChD,MAAM,EAAE,YAAY;IAClB,OAAOC,SAAc,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;GACrE;;EAED,GAAG,EAAE,UAAU,KAAK,EAAE;IACpB,IAAI,IAAI,GAAG,IAAI,CAAC;IAChBT,YAAU,CAAC,YAAY;MACrB,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KACjC,CAAC,CAAC;IACH,OAAO,IAAI,CAAC;GACb;CACF,CAAC,CAAC;;AAEI,SAASyB,MAAI,EAAE,UAAU,EAAE;EAChC,OAAO,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC;CAC7B;;AClBM,IAAIC,WAAS,GAAGC,OAAgB,CAAC;AACjC,IAAI5B,UAAQ,GAAG6B,UAAqB,CAAC;AACrC,IAAInC,cAAY,GAAGoC,cAAiB,CAAC;AACrC,IAAI5B,aAAW,GAAG6B,aAAwB,CAAC;AAC3C,IAAI1B,QAAM,GAAG2B,QAAmB,CAAC;AACjC,IAAIrC,aAAW,GAAGuB,aAAiB,CAAC;AACpC,IAAItB,QAAM,GAAGqC,QAAY,CAAC;AAC1B,IAAInC,UAAQ,GAAGoC,UAAc,CAAC;AAC9B,IAAIrC,cAAY,GAAGsC,cAAkB,CAAC;AACtC,IAAIxB,YAAU,GAAG,WAAW,CAAC;AAC7B,IAAIS,MAAI,GAAGgB,MAAK,CAAC;AACjB,IAAIhC,QAAM,GAAGiC,QAAmB,CAAC;AACjC,IAAIpC,YAAU,GAAGqC,YAAuB,CAAC;AACzC,IAAIZ,MAAI,GAAGa,MAAK,CAAC;;;;;AAKjB,SAASC,QAAM,EAAE,KAAK,EAAE;EAC7B,IAAI,IAAI,GAAGrC,KAAU,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;EACpC,OAAOQ,YAAU,CAAC,YAAY;IAC5B,IAAI,CAAC,GAAG,EAAE,CAAC;IACX,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACnC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;MACd,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE;QACnB,CAAC,IAAI8B,QAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;OACtB;KACF;IACD,OAAO,CAAC,CAAC;GACV,CAAC,CAAC;CACJ,CAAC;;;;;AAKK,SAASA,QAAM,EAAE,KAAK,EAAE;EAC7B,IAAI9C,aAAW,CAAC,KAAK,CAAC,EAAE;IACtB,OAAO,KAAK,CAAC,GAAG,EAAE,CAAC;GACpB,MAAM;IACL,OAAO,KAAK,CAAC;GACd;CACF,CAAC;;;;;AAKK,SAAS+C,MAAI,EAAE,CAAC,EAAE;EACvB,OAAO,YAAY;IACjB,IAAI,IAAI,GAAG,SAAS,CAAC;IACrB,IAAI,IAAI,GAAG,IAAI,CAAC;IAChB,OAAO/B,YAAU,CAAC,YAAY;MAC5B,OAAO,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE8B,QAAM,CAAC,CAAC,CAAC;KAC9D,CAAC,CAAC;GACJ,CAAC;CACH,CAAC;;AAEF,SAAS,UAAU,EAAE,KAAK,EAAE;EAC1B,IAAI9C,aAAW,CAAC,KAAK,CAAC,EAAE;IACtB,OAAO,KAAK,CAAC,GAAG,EAAE,CAAC;GACpB,MAAM,IAAI,KAAK,YAAY,KAAK,EAAE;IACjC,OAAO,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;GAC9B,MAAM,IAAI,KAAK,CAAC,WAAW,KAAK,MAAM,EAAE;IACvC,IAAI,MAAM,GAAG,EAAE,CAAC;IAChB,IAAIgD,MAAI,GAAGC,IAAS,CAAC,KAAK,CAAC,CAAC;IAC5B,KAAK,IAAI,CAAC,GAAGD,MAAI,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG;MAC9B,IAAI,IAAI,GAAGA,MAAI,CAAC,CAAC,CAAC,CAAC;MACnB,MAAM,CAAC,IAAI,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;KACxC;IACD,OAAO,MAAM,CAAC;GACf,MAAM;IACL,OAAO,KAAK,CAAC;GACd;CACF;;AAEM,SAASE,QAAM,EAAE,GAAG,EAAE;EAC3B,IAAI,GAAG,CAAC,WAAW,KAAK,MAAM,IAAI,GAAG,YAAY,KAAK,EAAE;IACtD,OAAOlC,YAAU,CAAC,YAAY;MAC5B,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;KACxB,CAAC,CAAC;GACJ,MAAM;IACL,MAAM,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;GAC3D;CACF,CAAC;;AAEK,SAASmC,mBAAiB,EAAE,CAAC,EAAE,IAAI,EAAE;EAC1C,IAAI,SAAS,GAAG,IAAI,CAAC;EACrB,OAAO,UAAU,QAAQ,EAAE;IACzB,IAAI,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;IAC/C,SAAS,GAAG,QAAQ,CAAC;IACrB,OAAO,MAAM,CAAC;GACf,CAAC;CACH;;AAEM,SAASC,qBAAmB,EAAE,CAAC,EAAE;EACtC,IAAI,QAAQ,GAAG,EAAE,CAAC;EAClBnC,qBAA6B,CAAC,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;EAChD,IAAI;IACF,CAAC,EAAE,CAAC;GACL,SAAS;IACRE,oBAA4B,EAAE,CAAC;GAChC;EACD,OAAO,QAAQ,CAAC;CACjB;;AAED,SAAS,OAAO,EAAE,OAAO,EAAE;EACzB,OAAO,YAAY;IACjB,IAAI,IAAI,GAAG,SAAS,CAAC;IACrB,OAAOH,YAAU,CAAC,YAAY;MAC5B,IAAI,GAAG,CAAC;MACR,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACpC,GAAG,GAAG8B,QAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACtB,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;UAChB,MAAM;SACP;OACF;MACD,OAAO,GAAG,CAAC;KACZ,CAAC,CAAC;GACJ,CAAC;CACH;AACD,SAAS,QAAQ,EAAE,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC,EAAE;AACnC,SAAS,UAAU,EAAE,CAAC,EAAE,EAAE,OAAO,UAAU,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;AAC3D,IAAIO,IAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC3B,IAAIC,KAAG,GAAG,OAAO,CAACC,IAAS,CAAC,CAAC;AAC7B,IAAIC,KAAG,GAAG,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;AACxC,IAAIC,MAAI,GAAG,OAAO,CAAC,UAAU,CAACF,IAAS,CAAC,CAAC,CAAC;;;AChI1C,IAAI,kBAAkB,GAAG;;;;;EAK9B,MAAM,EAAE,SAAyB;IAC/B,IAAI,IAAI,GAAG,IAAI,CAAC;IAChB,QAAQ,OAAgB;IACxB,KAAK,CAAC;MACJ,MAAM,IAAI,KAAK,CAAC,SAAuC;IACzD,KAAK,CAAC;MACJ,QAAQ,CAAQ;QACd,KAAK,MAAU;UACb,OAAOvC,UAAuB;YAC5B,GAAqB;WACtB,CAAC,CAAC;QACL,KAAK,MAAS;QACd,KAAK,EAAQ;UACX,OAAOA,EAAuB;YAC5B,OAAO,IAAI,CAAC,GAAG,EAAE,CAAC8B,QAAM,CAAC,CAAC,CAAG;WAC9B,CAAC,CAAC;QACL;UACE,GAAwB;YACtB,CAA0B;cACF;GACrB;AAC2B;YAC9B,OAAO9B,OAAuB;OACD;aAC5B,CAAC,CAAC;WACJ,CAAgC;OACD;cAC5B,IAAI,OAAO,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;cACtB,IAAI,EAAmB;cACvB,QAAQ,OAAO,EAAO;WACL;kBACb,OAAO,OAAO,CAAC,KAAK,CAAC,CAAC;WACV;gBACd,KAAK,IAAQ;kBACX,MAAsB;gBACxB;kBACE,IAAI,OAAO,IAAoB;aACD;mBAC7B,GAAM;oBACL,EAA0B;mBAC3B;eACJ;aACA;WACJ,KAAM;YACL,MAAM,KAAK,CAAC,WAAc;WAC3B;OACJ;IACH,KAAK,CAAC;MACJ,OAAOA,YAAU,CAAC,YAAY;QAC5B,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE8B,QAAM,CAAC,CAAC,CAAC,CAAC,CAAC;OACjC,CAAC,CAAC;IACL,KAAK,CAAC;MACJ,OAAO9B,YAAU,CAAC,YAAY;QAC5B,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE8B,QAAM,CAAC,CAAC,CAAC,EAAEA,GAAW;OAC5C,CAAC,CAAC;IACL,KAAK,CAAC;MACJ,OAAO9B,YAAU,CAAC,YAAY;QAC5B,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;iBACV8B,QAAM,CAAC,CAAC,CAAC;iBACTA,QAAM,CAAC,CAAC,CAAC;iBACTA,QAAM,CAAC,CAAC,CAAC,CAAC,CAAC;OACrB,CAAC,CAAC;IACL,KAAK,CAAC;MACJ,OAAO9B,YAAU,CAAC,YAAY;QAC5B,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;iBACV8B,QAAM,CAAG;iBACTA,QAAM,CAAC,CAAC,CAAC;iBACTA,EAAS;eACE;OACrB,CAAC,CAAC;IACL;MACE,IAAI,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAACtC,KAA0B;MACrD,KAA8B;OACW;OACxC,CAAC,CAAC;KACJ;GACF;;EAED,KAAK,EAAE,EAAmB;IACxB,WAAW,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;GAC5B;;EAED,MAAM,EAAE,CAAmB;IACzB,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAE;IACpC,IAAI,IAAI,IAAI,MAAM,IAAI,EAA4B;MAChD,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;MACrB,IAAI,OAAO,IAAI,KAAK,GAA8B;QAChD,IAAI,GAAGQ,YAAU,CAAC,EAAM;OACzB,EAAoC;QACnC,GAAuE;OACxE;MACD,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAO;KACzB;IACD,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,EAAEF,IAAsC;GAC5D;;EAED,EAAE,EAAE,GAAiB;IACnB,IAAI,IAAY;IAChB,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;MAC9B,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAEgC,QAAM,CAAS;KACxC,CAAC,CAAC;GACJ;;EAED,EAAsB;AAC0C;GAC/D;;EAED,EAAqB;AAC2C;GAC/D;;EAED,IAAI,EAAE,UAAU,UAAU,EAAE,UAAU,EAAE;IACtC,OAAO,IAAI,CAAC,MAAM,CAAC,IAAa;MAC9B,OAAOA,QAAM,CAAC,CAAC,GAAG,UAAU,GAAG,UAAU,CAAC,CAAC;KAC5C,CAAC,CAAC;GACJ;;EAED,KAAyC;IACvC,OAAO,IAAI,CAAC,MAAM,CAAC,OAAa;KACwB;KACvD,CAAC,CAAC;GACJ;;EAED,GAAG,EAAE,UAAU,KAAK,EAAE;IACpB,OAAO,IAAI,CAAC,IAAmB;GAChC;;EAED,KAAwB;IAC8B;AAClC;MAChB,OAAO,GAAG,CAAC,GAAG,CAAC,IAA0C;KAC1D,MAAM;IACiD;AACvD;GACF;;EAED,EAAuB;AACU;GAChC;;EAED,GAAG,EAAE,YAAY;IACf,GAAgD;GACjD;;EAED,YAAY,EAAE,UAAU,MAAM,EAAE;IAC9B,IAAI,MAAM,EAAE;MACV,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;OACW;IAC5C;AACI;MACL,MAAM,GAAG,IAAI,CAAC;KACf;;AAE4C;GAC9C;;EAED,QAAQ,EAAE,UAAgB;IACxB,OAAO,CAAC,IAAI,CAAC,OAAO,IAAIY,MAAW,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;GAC5C;CACF,CAAC;;AAEF,IAAwC;AACjB;EACrB,IAAI,IAAI,GAAG,IAAI,CAAC;EAChB,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;IACxB;AAC+B;MACnC,IAAI,IAAI,CAAC,KAA8B;QACrC,OAAOZ,QAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC1B;AACF;IACD,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;MACzB,OAAOA,IAAgB;KACxB;GACF,CAAC,CAAC;CACJ,CAAC;;ACtLK,IAAI,gBAAmB;EAC5B,GAAmB;AACmB;IACpC,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IACgB;AACtC;EACD,IAAI,EAAE,UAAU,WAAoB;IAClC,IAAI,IAAI,GAAG,IAAI,CAAC;IACA;EACG;AAC2B;OAC3C;MACD,GAAG,EAAE,UAAU,EAAK;QAClB,IAAI,CAAC,GAAG,CAAC,CAAyC;OACnD;KACF,CAAC,CAAC;GACJ;CACF,CAAC;;ACXF,MAAM,CAA2C;AACjD,KAA6D;AAC7D,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,SAAsC;;;AAGtD,IAAI,CAAgC;AACpC,EAAkC;AACQ;AAC1C,IAAI,WAAW,GAAGa,MAAsB;AACxC,IAAI,MAAM,GAAGC,QAAgB,CAAC;AAC9B,IAAI,WAAW,GAAGC,aAAqB,CAAC;AACxC,IAAI,MAAM,GAAGC,QAAgB,CAAC;AAC9B,IAAI,QAAQ,GAAGC,UAAkB,CAAC;AAClC,IAA0C;AAC1C,IAAI,UAAU,GAAGC,YAAoB,CAAC;AACtC,IAAI,IAAI,GAAGC,MAAc,CAAC;AAC1B,IAAI,MAAM,GAAGC,QAAiB;AAC9B,IAAI,UAAU,GAAGC,OAAqB;AACtC,IAAI,IAAI,GAAGC,MAAc,CAAC;AAC1B,IAAI,IAA0B;AAC9B,IAAI,MAAM,GAAGC,QAAgB,CAAC;AAC9B,IAAI,IAAI,GAAGC,MAAc,CAAC;AAC1B,IAAI,GAA0B;AAC9B,IAAI,GAAgD;AACpD,IAAwD;AACxD,EAAsB;AACE;AACxB,IAAI,GAAG,GAAGC,KAAa,CAAC;AACxB,IAAI,IAAI,GAAGC,MAAc,CAAC","sourcesContent":["export var keys = Object.keys;\n\nexport function assign (obj) {\n  for (var i = 1; i < arguments.length; i++) {\n    var other = arguments[i];\n    var ks = keys(other || {});\n    for (var j = ks.length; j--;) {\n      var prop = ks[j];\n      obj[prop] = other[prop];\n    }\n  }\n  return obj;\n}\n\nfunction _is(a, b) {\n  // SameValue algorithm\n  if (a === b) { // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    return a !== 0 || 1 / a === 1 / b;\n  } else {\n    // Step 6.a: NaN == NaN\n    return a !== a && b !== b;\n  }\n}\n\nexport function equals (a, b) {\n  return _is(a, b) || (a && typeof a.equals === 'function' && a.equals(b));\n};\n\nexport function addToArray (a, b) {\n  var i = a.indexOf(b);\n  if (i < 0) {\n    a.push(b);\n  }\n};\n\nexport function removeFromArray (a, b) {\n  var i = a.indexOf(b);\n  if (i >= 0) {\n    a.splice(i, 1);\n  }\n};\n\nvar _nextId = 0;\nexport function nextId () {\n  return _nextId++;\n};\n\nexport function slice (a, i) {\n  return Array.prototype.slice.call(a, i);\n};\n\nexport var unique = Object.freeze({equals: function () { return false; }});\n\nexport function some (x) {\n  return (x !== null) && (x !== void 0);\n};\n\nexport var DEBUG_MODE = false;\nexport function setDebugMode (val) {\n  DEBUG_MODE = !!val;\n};\n\nexport function setEquals (derivable, equals) {\n  derivable._equals = equals;\n  return derivable;\n};\n","export var ATOM = \"ATOM\";\nexport var DERIVATION = \"DERIVATION\";\nexport var LENS = \"LENS\";\nexport var REACTOR = \"REACTOR\";\n\nexport function isDerivable(x) {\n  return x &&\n         (x._type === DERIVATION ||\n          x._type === ATOM ||\n          x._type === LENS);\n}\n\nexport function isAtom (x) {\n  return x && (x._type === ATOM || x._type === LENS);\n}\n\nexport function isDerivation (x) {\n  return x && (x._type === DERIVATION || x._type === LENS);\n}\n\nexport function isLensed (x) {\n  return x && x._type === LENS;\n}\n","export var UNKNOWN = 0;\nexport var CHANGED = 1;\nexport var UNCHANGED = 2;\nexport var DISCONNECTED = 3;\n","import * as util from './util';\n\nvar parentsStack = [];\nvar child = null;\n\nexport function startCapturingParents (_child, parents) {\n  parentsStack.push({parents: parents, offset: 0, child: _child});\n  child = _child;\n}\nexport function retrieveParentsFrame () {\n  return parentsStack[parentsStack.length - 1];\n}\nexport function stopCapturingParents () {\n  parentsStack.pop();\n  child = parentsStack.length === 0\n          ? null\n          : parentsStack[parentsStack.length - 1].child;\n}\n\nexport function maybeCaptureParent (p) {\n  if (child !== null) {\n    var frame = parentsStack[parentsStack.length - 1];\n    if (frame.parents[frame.offset] === p) {\n      // nothing to do, just skip over\n      frame.offset++;\n    } else {\n      // look for this parent elsewhere\n      var idx = frame.parents.indexOf(p);\n      if (idx === -1) {\n        // not seen this parent yet, add it in the correct place\n        // and push the one currently there to the end (likely that we'll be\n        // getting rid of it)\n        // sneaky hack for doing captureDereferences\n        if (child !== void 0) {\n          util.addToArray(p._activeChildren, child);\n        }\n        if (frame.offset === frame.parents.length) {\n          frame.parents.push(p);\n        } else {\n          frame.parents.push(frame.parents[frame.offset]);\n          frame.parents[frame.offset] = p;\n        }\n        frame.offset++;\n      } else {\n        if (idx > frame.offset) {\n          // seen this parent after current point in array, so swap positions\n          // with current point's parent\n          var tmp = frame.parents[idx];\n          frame.parents[idx] = frame.parents[frame.offset];\n          frame.parents[frame.offset] = tmp;\n          frame.offset++;\n        }\n        // else seen this parent at previous point and so don't increment offset\n      }\n    }\n  }\n};\n","import * as util from './util';\nimport {DERIVATION, LENS, REACTOR} from './types';\nimport {UNKNOWN, UNCHANGED, CHANGED} from './states';\n\nexport function mark (node, reactors) {\n  for (var i = 0, len = node._activeChildren.length; i < len; i++) {\n    var child = node._activeChildren[i];\n    switch (child._type) {\n      case DERIVATION:\n      case LENS:\n        if (child._state !== UNKNOWN) {\n          child._state = UNKNOWN;\n          mark(child, reactors);\n        }\n        break;\n      case REACTOR:\n        reactors.push(child);\n        break;\n    }\n  }\n}\n\nexport function processReactors (reactors) {\n  for (var i = 0, len = reactors.length; i < len; i++) {\n    var r = reactors[i];\n    if (r._reacting) {\n      throw new Error(\"Synchronous cyclical reactions disallowed. \" +\n                      \"Use setImmediate.\");\n    }\n    r._maybeReact();\n  }\n}\n\nvar TransactionAbortion = {};\n\nfunction initiateAbortion() {\n  throw TransactionAbortion;\n}\n\nfunction TransactionContext(parent) {\n  this.parent = parent;\n  this.id2originalValue = {};\n  this.modifiedAtoms = [];\n}\n\nexport function maybeTrack (atom) {\n  if (currentCtx !== null) {\n    if (!(atom._id in currentCtx.id2originalValue)) {\n      currentCtx.modifiedAtoms.push(atom);\n      currentCtx.id2originalValue[atom._id] = atom._value;\n    }\n  }\n}\n\nexport var currentCtx = null;\n\nexport function inTransaction () {\n  return currentCtx !== null;\n};\n\nexport function transact (f) {\n  beginTransaction();\n  try {\n    f.call(null, initiateAbortion);\n  }\n  catch (e) {\n    abortTransaction();\n    if (e !== TransactionAbortion) {\n      throw e;\n    }\n    return;\n  }\n  commitTransaction();\n};\n\nexport function atomically (f) {\n  if (!inTransaction()) {\n    transact(f);\n  } else {\n    f();\n  }\n}\n\nexport function transaction (f) {\n  return function () {\n    var args = util.slice(arguments, 0);\n    var that = this;\n    var result;\n    transact(function () {\n      result = f.apply(that, args);\n    });\n    return result;\n  };\n};\n\nexport function atomic (f) {\n  return function () {\n    var args = util.slice(arguments, 0);\n    var that = this;\n    var result;\n    atomically(function () {\n      result = f.apply(that, args);\n    });\n    return result;\n  };\n}\n\nfunction beginTransaction() {\n  currentCtx = new TransactionContext(currentCtx);\n}\n\nfunction commitTransaction() {\n  var ctx = currentCtx;\n  currentCtx = ctx.parent;\n\n  if (currentCtx === null) {\n    var reactors = [];\n    ctx.modifiedAtoms.forEach(function (a) {\n      if (a.__equals(a._value, ctx.id2originalValue[a._id])) {\n        a._state = UNCHANGED;\n      } else {\n        a._state = CHANGED;\n        mark(a, reactors);\n      }\n    });\n    processReactors(reactors);\n    ctx.modifiedAtoms.forEach(function (a) {\n      a._state = UNCHANGED;\n    });\n  }\n}\n\nfunction abortTransaction() {\n  var ctx = currentCtx;\n  currentCtx = ctx.parent;\n  ctx.modifiedAtoms.forEach(function (atom) {\n    atom._value = ctx.id2originalValue[atom._id];\n    atom._state = UNCHANGED;\n    mark(atom, []);\n  });\n}\n\nvar _tickerRefCount = 0;\n\nexport function ticker () {\n  if (_tickerRefCount === 0) {\n    beginTransaction();\n  }\n  _tickerRefCount++;\n  var done = false;\n  return {\n    tick: function () {\n      if (done) throw new Error('trying to use ticker after release');\n      commitTransaction();\n      beginTransaction();\n    },\n    reset: function () {\n      if (done) throw new Error('trying to use ticker after release');\n      abortTransaction();\n      beginTransaction();\n    },\n    release: function () {\n      if (done) throw new Error('ticker already released');\n      _tickerRefCount--;\n      done = true;\n      if (_tickerRefCount === 0) {\n        commitTransaction();\n      }\n    },\n  };\n};\n","import * as util from './util';\nimport * as parents from './parents';\nimport * as transactions from './transactions';\nimport * as types from './types';\nimport {CHANGED, UNCHANGED, UNKNOWN, DISCONNECTED} from './states';\n\nexport function Derivation (deriver) {\n  this._deriver = deriver;\n  this._parents = null;\n  this._type = types.DERIVATION;\n  this._value = util.unique;\n  this._equals = null;\n  this._activeChildren = [];\n  this._state = DISCONNECTED;\n\n  if (util.DEBUG_MODE) {\n    this.stack = Error().stack;\n  }\n};\n\nutil.assign(Derivation.prototype, {\n  _clone: function () {\n    return util.setEquals(derivation(this._deriver), this._equals);\n  },\n\n  _forceEval: function () {\n    var that = this;\n    var newVal = null;\n    var newNumParents;\n\n    try {\n      if (this._parents === null) {\n        this._parents = [];\n      }\n      parents.startCapturingParents(this, this._parents);\n      if (!util.DEBUG_MODE) {\n        newVal = that._deriver();\n      } else {\n        try {\n          newVal = that._deriver();\n        } catch (e) {\n          console.error(that.stack);\n          throw e;\n        }\n      }\n      newNumParents = parents.retrieveParentsFrame().offset;\n    } finally {\n      parents.stopCapturingParents();\n    }\n\n    if (!this.__equals(newVal, this._value)) {\n      this._state = CHANGED;\n    } else {\n      this._state = UNCHANGED;\n    }\n\n    for (var i = newNumParents, len = this._parents.length; i < len; i++) {\n      var oldParent = this._parents[i];\n      detach(oldParent, this);\n      this._parents[i] = null;\n    }\n\n    this._parents.length = newNumParents;\n\n    this._value = newVal;\n  },\n\n  _update: function () {\n    if (this._parents === null) {\n      // this._state === DISCONNECTED\n      this._forceEval();\n      // this._state === CHANGED ?\n    } else if (this._state === UNKNOWN) {\n      var len = this._parents.length;\n      for (var i = 0; i < len; i++) {\n        var parent = this._parents[i];\n\n        if (parent._state === UNKNOWN) {\n          parent._update();\n        }\n\n        if (parent._state === CHANGED) {\n          this._forceEval();\n          break;\n        }\n      }\n      if (this._state === UNKNOWN) {\n        this._state = UNCHANGED;\n      }\n    }\n  },\n\n  get: function () {\n    parents.maybeCaptureParent(this);\n    if (this._activeChildren.length > 0) {\n      this._update();\n    } else {\n      parents.startCapturingParents(void 0, []);\n      try {\n        this._value = this._deriver();\n      } finally {\n        parents.stopCapturingParents();\n      }\n    }\n    return this._value;\n  },\n});\n\nexport function detach (parent, child) {\n  util.removeFromArray(parent._activeChildren, child);\n  if (parent._activeChildren.length === 0 && parent._parents != null) {\n    var len = parent._parents.length;\n    for (var i = 0; i < len; i++) {\n      detach(parent._parents[i], parent);\n    }\n    parent._parents = null;\n    parent._state = DISCONNECTED;\n  }\n}\n\nexport function derivation (deriver) {\n  return new Derivation(deriver);\n}\n","import * as types from './types';\nimport * as util from './util';\nimport {DISCONNECTED, UNKNOWN, UNCHANGED, CHANGED} from './states';\nimport {detach, derivation} from './derivation';\n\nexport function Reactor(parent, react, governor) {\n  this._parent = parent;\n  this.react = react;\n  this._governor = governor || null;\n  this._active = false;\n  this._reacting = false;\n  this._type = types.REACTOR;\n\n  if (util.DEBUG_MODE) {\n    this.stack = Error().stack;\n  }\n}\n\nutil.assign(Reactor.prototype, {\n  start: function () {\n    this._active = true;\n\n    util.addToArray(this._parent._activeChildren, this);\n\n    this._parent.get();\n    return this;\n  },\n\n  _force: function (nextValue) {\n    try {\n      this._reacting = true;\n      this.react(nextValue);\n    } catch (e) {\n      if (util.DEBUG_MODE) {\n        console.error(this.stack);\n      }\n      throw e;\n    } finally {\n      this._reacting = false;\n    }\n  },\n\n  force: function () {\n    this._force(this._parent.get());\n\n    return this;\n  },\n\n  _maybeReact: function () {\n    if (!this._reacting && this._active) {\n      if (this._governor !== null) {\n        this._governor._maybeReact();\n      }\n      // maybe the reactor was stopped by the parent\n      if (this._active) {\n        var nextValue = this._parent.get();\n        if (this._parent._state === CHANGED) {\n          this._force(nextValue);\n        }\n      }\n    }\n  },\n  stop: function () {\n    detach(this._parent, this);\n    this._active = false;\n    return this;\n  },\n});\n\nexport function makeReactor (derivable, f, opts) {\n  if (typeof f !== 'function') {\n    throw Error('the first argument to .react must be a function');\n  }\n\n  opts = util.assign({\n    once: false,\n    from: true,\n    until: false,\n    when: true,\n    skipFirst: false,\n  }, opts);\n\n  var skipFirst = opts.skipFirst;\n\n  // coerce fn or bool to derivable<bool>\n  function condDerivable(fOrD, name) {\n    if (!types.isDerivable(fOrD)) {\n      if (typeof fOrD === 'function') {\n        return derivation(fOrD);\n      } else if (typeof fOrD === 'boolean') {\n        return derivation(function () { return fOrD; });\n      } else {\n        throw Error('react ' + name + ' condition must be derivable, got: ' + JSON.stringify(fOrD));\n      }\n    }\n    return fOrD;\n  }\n\n  // wrap reactor so f doesn't get a .this context, and to allow\n  // stopping after one reaction if desired.\n  var reactor = new Reactor(derivable, function (val) {\n    if (skipFirst) {\n      skipFirst = false;\n    } else {\n      f(val);\n      if (opts.once) {\n        this.stop();\n        controller.stop();\n      }\n    }\n  });\n\n  // listen to when and until conditions, starting and stopping the\n  // reactor as appropriate, and stopping this controller when until\n  // condition becomes true\n  var $until = condDerivable(opts.until, 'until');\n  var $when = condDerivable(opts.when, 'when');\n\n  var $whenUntil = derivation(function () {\n    return {\n      until: $until.get(),\n      when: $when.get(),\n    };\n  });\n\n  var controller = new Reactor($whenUntil, function (conds) {\n    if (conds.until) {\n      reactor.stop();\n      this.stop();\n    } else if (conds.when) {\n      if (!reactor._active) {\n        reactor.start().force();\n      }\n    } else if (reactor._active) {\n      reactor.stop();\n    }\n  });\n\n  reactor._governor = controller;\n\n  // listen to from condition, starting the reactor controller\n  // when appropriate\n  var $from = condDerivable(opts.from, 'from');\n  var initiator = new Reactor($from, function (from) {\n    if (from) {\n      controller.start().force();\n      this.stop();\n    }\n  });\n\n  initiator.start().force();\n}\n","import * as util from './util';\nimport * as transactions from './transactions';\nimport * as parents from './parents';\nimport {ATOM} from './types';\nimport {UNCHANGED, CHANGED} from './states';\n\nexport function Atom (value) {\n  this._id = util.nextId();\n  this._activeChildren = [];\n  this._value = value;\n  this._state = UNCHANGED;\n  this._type = ATOM;\n  this._equals = null;\n  return this;\n};\n\nutil.assign(Atom.prototype, {\n  _clone: function () {\n    return util.setEquals(atom(this._value), this._equals);\n  },\n\n  set: function (value) {\n    transactions.maybeTrack(this);\n\n    var oldValue = this._value;\n    this._value = value;\n\n    if (!transactions.inTransaction()) {\n      if (!this.__equals(value, oldValue)) {\n        try {\n          this._state = CHANGED;\n          var reactors = [];\n          transactions.mark(this, reactors);\n          transactions.processReactors(reactors);\n        } finally {\n          this._state = UNCHANGED;\n        }\n      }\n    }\n  },\n\n  get: function () {\n    parents.maybeCaptureParent(this);\n    return this._value;\n  },\n});\n\nexport function atom (value) {\n  return new Atom(value);\n}\n","import * as util from './util';\nimport * as types from './types';\nimport {Derivation} from './derivation';\nimport {atomically} from './transactions';\n\nexport function Lens (descriptor) {\n  Derivation.call(this, descriptor.get);\n  this._lensDescriptor = descriptor;\n  this._type = types.LENS;\n}\n\nutil.assign(Lens.prototype, Derivation.prototype, {\n  _clone: function () {\n    return util.setEquals(new Lens(this._lensDescriptor), this._equals);\n  },\n\n  set: function (value) {\n    var that = this;\n    atomically(function () {\n      that._lensDescriptor.set(value);\n    });\n    return this;\n  },\n});\n\nexport function lens (descriptor) {\n  return new Lens(descriptor);\n}\n","import * as util from './util';\nimport * as transactions from './transactions';\nimport {atom as _atom} from './atom';\nimport * as reactors from './reactors';\nimport * as parents from './parents';\nimport * as types from './types';\nimport {derivation as _derivation} from './derivation';\nimport {lens as _lens} from './lens';\n\nexport var __Reactor = reactors.Reactor;\nexport var transact = transactions.transact;\nexport var setDebugMode = util.setDebugMode;\nexport var transaction = transactions.transaction;\nexport var ticker = transactions.ticker;\nexport var isDerivable = types.isDerivable;\nexport var isAtom = types.isAtom;\nexport var isLensed = types.isLensed;\nexport var isDerivation = types.isDerivation;\nexport var derivation = _derivation;\nexport var atom = _atom;\nexport var atomic = transactions.atomic;\nexport var atomically = transactions.atomically;\nexport var lens = _lens;\n\n/**\n * Template string tag for derivable strings\n */\nexport function derive (parts) {\n  var args = util.slice(arguments, 1);\n  return derivation(function () {\n    var s = \"\";\n    for (var i=0; i < parts.length; i++) {\n      s += parts[i];\n      if (i < args.length) {\n        s += unpack(args[i]);\n      }\n    }\n    return s;\n  });\n};\n\n/**\n * dereferences a thing if it is dereferencable, otherwise just returns it.\n */\nexport function unpack (thing) {\n  if (isDerivable(thing)) {\n    return thing.get();\n  } else {\n    return thing;\n  }\n};\n\n/**\n * lifts a non-monadic function to work on derivables\n */\nexport function lift (f) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return derivation(function () {\n      return f.apply(that, Array.prototype.map.call(args, unpack));\n    });\n  };\n};\n\nfunction deepUnpack (thing) {\n  if (isDerivable(thing)) {\n    return thing.get();\n  } else if (thing instanceof Array) {\n    return thing.map(deepUnpack);\n  } else if (thing.constructor === Object) {\n    var result = {};\n    var keys = util.keys(thing);\n    for (var i = keys.length; i--;) {\n      var prop = keys[i];\n      result[prop] = deepUnpack(thing[prop]);\n    }\n    return result;\n  } else {\n    return thing;\n  }\n}\n\nexport function struct (arg) {\n  if (arg.constructor === Object || arg instanceof Array) {\n    return derivation(function () {\n      return deepUnpack(arg);\n    });\n  } else {\n    throw new Error(\"`struct` expects plain Object or Array\");\n  }\n};\n\nexport function wrapPreviousState (f, init) {\n  var lastState = init;\n  return function (newState) {\n    var result = f.call(this, newState, lastState);\n    lastState = newState;\n    return result;\n  };\n}\n\nexport function captureDereferences (f) {\n  var captured = [];\n  parents.startCapturingParents(void 0, captured);\n  try {\n    f();\n  } finally {\n    parents.stopCapturingParents();\n  }\n  return captured;\n}\n\nfunction andOrFn (breakOn) {\n  return function () {\n    var args = arguments;\n    return derivation(function () {\n      var val;\n      for (var i = 0; i < args.length; i++) {\n        val = unpack(args[i]);\n        if (breakOn(val)) {\n          break;\n        }\n      }\n      return val;\n    });\n  };\n}\nfunction identity (x) { return x; }\nfunction complement (f) { return function (x) { return !f(x); }; }\nexport var or = andOrFn(identity);\nexport var mOr = andOrFn(util.some);\nexport var and = andOrFn(complement(identity));\nexport var mAnd = andOrFn(complement(util.some));\n","import * as util from './util';\nimport {makeReactor} from './reactors';\nimport * as types from './types';\nimport {derivation, unpack, lift} from './module';\n\nexport var derivablePrototype = {\n    /**\n     * Creates a derived value whose state will always be f applied to this\n     * value\n     */\n  derive: function (f, a, b, c, d) {\n    var that = this;\n    switch (arguments.length) {\n    case 0:\n      throw new Error('.derive takes at least one argument');\n    case 1:\n      switch (typeof f) {\n        case 'function':\n          return derivation(function () {\n            return f(that.get());\n          });\n        case 'string':\n        case 'number':\n          return derivation(function () {\n            return that.get()[unpack(f)];\n          });\n        default:\n          if (f instanceof Array) {\n            return f.map(function (x) {\n              return that.derive(x);\n            });\n          } else if (f instanceof RegExp) {\n            return derivation(function () {\n              return that.get().match(f);\n            });\n          } else if (types.isDerivable(f)) {\n            return derivation(function () {\n              var deriver = f.get();\n              var thing = that.get();\n              switch (typeof deriver) {\n                case 'function':\n                  return deriver(thing);\n                case 'string':\n                case 'number':\n                  return thing[deriver];\n                default:\n                  if (deriver instanceof RegExp) {\n                    return thing.match(deriver);\n                  } else {\n                    throw Error('type error');\n                  }\n              }\n            });\n          } else {\n            throw Error('type error');\n          }\n      }\n    case 2:\n      return derivation(function () {\n        return f(that.get(), unpack(a));\n      });\n    case 3:\n      return derivation(function () {\n        return f(that.get(), unpack(a), unpack(b));\n      });\n    case 4:\n      return derivation(function () {\n        return f(that.get(),\n                 unpack(a),\n                 unpack(b),\n                 unpack(c));\n      });\n    case 5:\n      return derivation(function () {\n        return f(that.get(),\n                 unpack(a),\n                 unpack(b),\n                 unpack(c),\n                 unpack(d));\n      });\n    default:\n      var args = ([that]).concat(util.slice(arguments, 1));\n      return derivation(function () {\n        return f.apply(null, args.map(unpack));\n      });\n    }\n  },\n\n  react: function (f, opts) {\n    makeReactor(this, f, opts);\n  },\n\n  mReact: function (f, opts) {\n    var mWhen = this.mThen(true, false);\n    if (opts && 'when' in opts && opts.when !== true) {\n      var when = opts.when;\n      if (typeof when === 'function' || when === false) {\n        when = derivation(when);\n      } else if (!types.isDerivable(when)) {\n        throw new Error('when condition must be bool, function, or derivable');\n      }\n      mWhen = when.and(mWhen);\n    }\n    return this.react(f, util.assign({}, opts, {when: mWhen}));\n  },\n\n  is: function (other) {\n    var that = this;\n    return this.derive(function (x) {\n      return that.__equals(x, unpack(other));\n    });\n  },\n\n  and: function (other) {\n    return this.derive(function (x) {return x && unpack(other);});\n  },\n\n  or: function (other) {\n    return this.derive(function (x) {return x || unpack(other);});\n  },\n\n  then: function (thenClause, elseClause) {\n    return this.derive(function (x) {\n      return unpack(x ? thenClause : elseClause);\n    });\n  },\n\n  mThen: function (thenClause, elseClause) {\n    return this.derive(function (x) {\n      return unpack(util.some(x) ? thenClause : elseClause);\n    });\n  },\n\n  mOr: function (other) {\n    return this.mThen(this, other);\n  },\n\n  mDerive: function (arg) {\n    if (arguments.length === 1 && arg instanceof Array) {\n      var that = this;\n      return arg.map(function (a) { return that.mDerive(a); });\n    } else {\n      return this.mThen(this.derive.apply(this, arguments));\n    }\n  },\n\n  mAnd: function (other) {\n    return this.mThen(other, this);\n  },\n\n  not: function () {\n    return this.derive(function (x) { return !x; });\n  },\n\n  withEquality: function (equals) {\n    if (equals) {\n      if (typeof equals !== 'function') {\n        throw new Error('equals must be function');\n      }\n    } else {\n      equals = null;\n    }\n\n    return util.setEquals(this._clone(), equals);\n  },\n\n  __equals: function (a, b) {\n    return (this._equals || util.equals)(a, b);\n  },\n};\n\nderivablePrototype.switch = function () {\n  var args = arguments;\n  var that = this;\n  return this.derive(function (x) {\n    var i;\n    for (i = 0; i < args.length-1; i+=2) {\n      if (that.__equals(x, unpack(args[i]))) {\n        return unpack(args[i+1]);\n      }\n    }\n    if (i === args.length - 1) {\n      return unpack(args[i]);\n    }\n  });\n};\n","import * as util from './util';\nimport {Lens} from './lens';\n\nexport var mutablePrototype = {\n  swap: function (f) {\n    var args = util.slice(arguments, 0);\n    args[0] = this.get();\n    return this.set(f.apply(null, args));\n  },\n  lens: function (monoLensDescriptor) {\n    var that = this;\n    return new Lens({\n      get: function () {\n        return monoLensDescriptor.get(that.get());\n      },\n      set: function (val) {\n        that.set(monoLensDescriptor.set(that.get(), val));\n      }\n    });\n  },\n};\n","import {derivablePrototype} from './derivable';\nimport {mutablePrototype} from './mutable';\nimport {Derivation} from './derivation';\nimport {Lens} from './lens';\nimport {Atom} from './atom';\nimport {assign} from './util';\n\nimport * as derivable from './module';\n\nassign(Derivation.prototype, derivablePrototype);\nassign(Lens.prototype, derivablePrototype, mutablePrototype);\nassign(Atom.prototype, derivablePrototype, mutablePrototype);\n\n\nexport var __Reactor = derivable.__Reactor;\nexport var transact = derivable.transact;\nexport var setDebugMode = derivable.setDebugMode;\nexport var transaction = derivable.transaction;\nexport var ticker = derivable.ticker;\nexport var isDerivable = derivable.isDerivable;\nexport var isAtom = derivable.isAtom;\nexport var isLensed = derivable.isLensed;\nexport var isDerivation = derivable.isDerivation;\nexport var derivation = derivable.derivation;\nexport var atom = derivable.atom;\nexport var atomic = derivable.atomic;\nexport var atomically = derivable.atomically;\nexport var lens = derivable.lens;\nexport var derive = derivable.derive;\nexport var unpack = derivable.unpack;\nexport var lift = derivable.lift;\nexport var struct = derivable.struct;\nexport var wrapPreviousState = derivable.wrapPreviousState;\nexport var captureDereferences = derivable.captureDereferences;\nexport var or = derivable.or;\nexport var mOr = derivable.mOr;\nexport var and = derivable.and;\nexport var mAnd = derivable.mAnd;\n\nexport default derivable;\n"]}